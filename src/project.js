require=function e(i,t,s){function o(h,c){if(!t[h]){if(!i[h]){var r="function"==typeof require&&require;if(!c&&r)return r(h,!0);if(a)return a(h,!0);var n=new Error("Cannot find module '"+h+"'");throw n.code="MODULE_NOT_FOUND",n}var l=t[h]={exports:{}};i[h][0].call(l.exports,function(e){var t=i[h][1][e];return o(t||e)},l,l.exports,e,i,t,s)}return t[h].exports}for(var a="function"==typeof require&&require,h=0;h<s.length;h++)o(s[h]);return o}({JoystickDefines:[function(e,i,t){"use strict";cc._RF.push(i,"6aacbXuaJNBopX3MRTBFWkR","JoystickDefines"),i.exports={DirectionType:cc.Enum({FOUR:4,EIGHT:8,ALL:0})},cc._RF.pop()},{}],bomb:[function(e,i,t){"use strict";cc._RF.push(i,"2e6d6m4xqZMJpfcbX3jdtum","bomb"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.director.getCollisionManager().enabled=!0},start:function(){},explode:function(){var e=new cc.Event.EventCustom("bombExplode",!0);e.setUserData(this.node.position),this.node.dispatchEvent(e)},onAnimCompleted:function(){this.node.destroy()}}),cc._RF.pop()},{}],enemy:[function(e,i,t){"use strict";cc._RF.push(i,"aa569vLTSxDpZloDMiYxAv9","enemy");var s=cc.Enum({UP:-1,RIGHT:2,DOWN:1,LEFT:-2});cc.Class({extends:cc.Component,properties:{enemyMaxSpeed:0,game:{default:null,serializable:!1},direction:{default:s.UP,type:s}},onLoad:function(){this.xSpeed=0,this.ySpeed=0,this.enemyMaxSpeed=5},start:function(){},update:function(e){if(!this.game._gameLost){var i=this.node.getPosition();if(this.direction===s.LEFT){var t=this;cc.loader.loadRes("monster/monsterLeft",cc.SpriteFrame,function(e,i){e?console.log(e):t.node.getComponent(cc.Sprite).spriteFrame=i});var o=this.game.getTilePos(cc.p(i.x-this.enemyMaxSpeed,i.y));if(this.tryMoveToTarTile(o))this.xSpeed=-this.enemyMaxSpeed;else{var a=this.game.getTilePixelPos(cc.p(o.x+1,o.y));this.node.setPosition(cc.p(a.x+1,i.y)),this.xSpeed=0;var h=this.game.getTilePos(cc.p(i.x+this.node.width+this.enemyMaxSpeed,i.y));this.tryMoveToTarTile(h)?this.direction=s.RIGHT:this.direction=s.UP}}if(this.direction===s.RIGHT){var c=this;cc.loader.loadRes("monster/monsterRight",cc.SpriteFrame,function(e,i){e?console.log(e):c.node.getComponent(cc.Sprite).spriteFrame=i});var r=this.game.getTilePos(cc.p(i.x+this.node.width+this.enemyMaxSpeed,i.y));if(this.tryMoveToTarTile(r))this.xSpeed=this.enemyMaxSpeed;else{var n=this.game.getTilePixelPos(cc.p(r.x-1,r.y));this.node.setPosition(cc.p(n.x+1,i.y)),this.xSpeed=0;var l=this.game.getTilePos(cc.p(i.x-this.enemyMaxSpeed,i.y));this.tryMoveToTarTile(l)?this.direction=s.LEFT:this.direction=s.DOWN}}if(this.direction!==s.LEFT&&this.direction!==s.RIGHT&&(this.xSpeed=0),this.node.x+=this.xSpeed,this.direction===s.UP){var p=this;cc.loader.loadRes("monster/monsterBack",cc.SpriteFrame,function(e,i){e?console.log(e):p.node.getComponent(cc.Sprite).spriteFrame=i});var y=this.game.getTilePos(cc.p(i.x,i.y+this.game.tileSize.height+this.enemyMaxSpeed));if(this.tryMoveToTarTile(y))this.ySpeed=this.enemyMaxSpeed;else{var d=this.game.getTilePixelPos(cc.p(y.x,y.y+1));this.node.setPosition(i.x,d.y+1),this.node.ySpeed=0,this.tryMoveToTarTile(this.game.getTilePos(cc.p(i.x,i.y-this.enemyMaxSpeed)))?this.direction=s.DOWN:this.direction=s.LEFT}}if(this.direction===s.DOWN){var m=this;cc.loader.loadRes("monster/monsterFront",cc.SpriteFrame,function(e,i){e?console.log(e):m.node.getComponent(cc.Sprite).spriteFrame=i});var T=this.game.getTilePos(cc.p(i.x,i.y-this.enemyMaxSpeed));if(this.tryMoveToTarTile(T))this.ySpeed=-this.enemyMaxSpeed;else{var g=this.game.getTilePixelPos(cc.p(T.x,T.y-1));this.node.setPosition(i.x,g.y+1),this.node.ySpeed=0,this.tryMoveToTarTile(this.game.getTilePos(cc.p(i.x,i.y+this.game.tileSize.height+this.enemyMaxSpeed)))?this.direction=s.UP:this.direction=s.LEFT}}this.direction!==s.UP&&this.direction!==s.DOWN&&(this.ySpeed=0),this.node.y+=this.ySpeed}},tryMoveToTarTile:function(e){if(this.game.mainLayer.getTileGIDAt(e))return!1;if(null!=this.game.bombTiles&&0!==this.game.bombTiles.length)for(var i in this.game.bombTiles)if(e.equals(this.game.bombTiles[i]))return!1;return!cc.pointEqualToPoint(this.game.playerTile,e)||(console.log("Touch enemy,you lose!"),!1)},onCollisionEnter:function(e,i){this.game._enemyCount--,this.node.destroy()}}),cc._RF.pop()},{}],fireHorAnim:[function(e,i,t){"use strict";cc._RF.push(i,"007812BYzxOqbgD17iM5+yF","fireHorAnim"),cc.Class({extends:cc.Component,properties:{},start:function(){},fireAnimationEnd:function(){this.node.destroy()}}),cc._RF.pop()},{}],fireVerAnim:[function(e,i,t){"use strict";cc._RF.push(i,"d2fe4CmAelOr79FwF3AOSv6","fireVerAnim"),cc.Class({extends:cc.Component,properties:{},start:function(){},fireAnimationEnd:function(){this.node.destroy()}}),cc._RF.pop()},{}],game:[function(e,i,t){"use strict";cc._RF.push(i,"36db3bnkg5BorcduuETUu7z","game"),cc.Class({extends:cc.Component,properties:{maxMoveSpeed:0,maxBombCount:1,bombCount:0,fireLength:0,playerTile:{default:cc.p(0,0)},mapSize:{default:cc.size(0,0)},tileSize:{default:cc.size(0,0)},lblResult:{default:null,type:cc.Label},bombTiles:{default:[],type:[cc.Vec2]},bombPrefab:{default:null,type:cc.Prefab},player:{default:null,type:cc.Node},monster:{default:null,type:cc.Prefab},fireHor:{default:null,type:cc.Prefab},fireVer:{default:null,type:cc.Prefab},map:{default:null,type:cc.TiledMap},mainLayer:{default:null,type:cc.TiledLayer},hideLayer:{default:null,type:cc.TiledLayer},_enemyCount:0,_gameLost:!1},onLoad:function(){this.mapSize=this.node.getContentSize(),this.tileSize=this.map.getTileSize(),this.player.accLeft=!1,this.player.accRight=!1,this.player.accUp=!1,this.player.accDown=!1,this.player.xSpeed=0,this.player.ySpeed=0,this.bombTiles=[],this.loadMap(),this.node.on("bombExplode",this.bombExploded,this)},start:function(){},loadMap:function(){var e=this;this.map.getObjectGroup("objects").getObjects().forEach(function(i){if("player"===i.getProperty("name")){var t=cc.p(i.getProperty("x"),e.mapSize.height-2*i.getProperty("y"));e.player.setPosition(t),e.playerTile=e.getTilePos(e.player.position)}else{var s=cc.p(i.getProperty("x"),e.mapSize.height-i.getProperty("y")-e.tileSize.height),o=cc.instantiate(e.monster);o.getComponent("enemy").game=e,o.setAnchorPoint(cc.p(0,0)),o.setPosition(s),e.mainLayer.node.addChild(o),e._enemyCount++}})},willSetABombAction:function(){this.setABomb()},setABomb:function(){this.bombCount++;var e=cc.instantiate(this.bombPrefab);this.mainLayer.node.addChild(e);var i=this.getTilePos(this.player.getPosition()),t=this.getTilePixelPos(i);this.player.x-t.x>this.tileSize.width/2&&(i=cc.p(i.x+1,i.y)),t=this.getTilePixelPos(i),e.setPosition(cc.p(t.x+.5*this.tileSize.width,t.y+.5*this.tileSize.height)),this.bombTiles.push(i)},bombExploded:function(e){e.stopPropagation();var i=e.detail,t=this.getTilePos(i);this.createBombFire(cc.p(t.x,t.y)),t.equals(this.playerTile)&&(this._gameLost=!0);for(var s in this.bombTiles)t.equals(this.bombTiles[s])&&this.bombTiles.splice(s,1);this.bombCount--},createBombFire:function(e){if(null==this.getTileType(this.mainLayer,cc.p(e.x+1,e.y))){var i=cc.p(e.x+1,e.y+1),t=cc.instantiate(this.fireHor);if(this.mainLayer.node.addChild(t),t.setPosition(cc.p(i.x*this.tileSize.width,this.mapSize.height-i.y*this.tileSize.width)),null==this.getTileType(this.mainLayer,cc.p(e.x+2,e.y))){var s=cc.p(e.x+2,e.y+1),o=cc.instantiate(this.fireHor);this.mainLayer.node.addChild(o),o.setPosition(cc.p(s.x*this.tileSize.width,this.mapSize.height-s.y*this.tileSize.width))}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x+2,e.y))?this.mainLayer.removeTileAt(cc.p(e.x+2,e.y)):"player"===this.getTileType(this.mainLayer,cc.p(e.x+2,e.y))&&(this._gameLost=!0)}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x+1,e.y))?this.mainLayer.removeTileAt(cc.p(e.x+1,e.y)):"player"===this.getTileType(this.mainLayer,cc.p(e.x+1,e.y))&&(this._gameLost=!0);if(null==this.getTileType(this.mainLayer,cc.p(e.x-1,e.y))){var a=cc.p(e.x-1,e.y+1),h=cc.instantiate(this.fireHor);if(this.mainLayer.node.addChild(h),h.setPosition(cc.p(a.x*this.tileSize.width,this.mapSize.height-a.y*this.tileSize.width)),null==this.getTileType(this.mainLayer,cc.p(e.x-2,e.y))){var c=cc.p(e.x-2,e.y+1),r=cc.instantiate(this.fireHor);this.mainLayer.node.addChild(r),r.setPosition(cc.p(c.x*this.tileSize.width,this.mapSize.height-c.y*this.tileSize.width))}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x-2,e.y))?this.mainLayer.removeTileAt(cc.p(e.x-2,e.y)):"player"===this.getTileType(this.mainLayer,cc.p(e.x-2,e.y))&&(this._gameLost=!0)}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x-1,e.y))?this.mainLayer.removeTileAt(cc.p(e.x-1,e.y)):"player"===this.getTileType(this.mainLayer,cc.p(e.x-1,e.y))&&(this._gameLost=!0);if(null==this.getTileType(this.mainLayer,cc.p(e.x,e.y+1))){var n=cc.p(e.x,e.y+2),l=cc.instantiate(this.fireVer);if(this.mainLayer.node.addChild(l),l.setPosition(cc.p(n.x*this.tileSize.width,this.mapSize.height-n.y*this.tileSize.width)),null==this.getTileType(this.mainLayer,cc.p(e.x,e.y+2))){var p=cc.p(e.x,e.y+3),y=cc.instantiate(this.fireVer);this.mainLayer.node.addChild(y),y.setPosition(cc.p(p.x*this.tileSize.width,this.mapSize.height-p.y*this.tileSize.width))}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x,e.y+2))?this.mainLayer.removeTileAt(cc.p(e.x,e.y+2)):"player"===this.getTileType(this.mainLayer,cc.p(e.x,e.y+2))&&(this._gameLost=!0)}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x,e.y+1))?this.mainLayer.removeTileAt(cc.p(e.x,e.y+1)):"player"===this.getTileType(this.mainLayer,cc.p(e.x,e.y+1))&&(this._gameLost=!0);if(null==this.getTileType(this.mainLayer,cc.p(e.x,e.y-1))){var d=cc.p(e.x,e.y),m=cc.instantiate(this.fireVer);if(this.mainLayer.node.addChild(m),m.setPosition(cc.p(d.x*this.tileSize.width,this.mapSize.height-d.y*this.tileSize.width)),null==this.getTileType(this.mainLayer,cc.p(e.x,e.y-2))){var T=cc.p(e.x,e.y-1),g=cc.instantiate(this.fireVer);this.mainLayer.node.addChild(g),g.setPosition(cc.p(T.x*this.tileSize.width,this.mapSize.height-T.y*this.tileSize.width))}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x,e.y-2))?this.mainLayer.removeTileAt(cc.p(e.x,e.y-2)):"player"===this.getTileType(this.mainLayer,cc.p(e.x,e.y-2))&&(this._gameLost=!0)}else"brick"===this.getTileType(this.mainLayer,cc.p(e.x,e.y-1))?this.mainLayer.removeTileAt(cc.p(e.x,e.y-1)):"player"===this.getTileType(this.mainLayer,cc.p(e.x,e.y-1))&&(this._gameLost=!0)},update:function(e){if(this._gameLost)cc.director.loadScene("Game");else{if(0===this._enemyCount)return this.lblResult.string="You Win!",void(this.lblResult.node.opacity=255);var i=this.player.getPosition();if(this.player.accLeft){var t=this;cc.loader.loadRes("Player/left",cc.SpriteFrame,function(e,i){e?console.log(e):t.player.getComponent(cc.Sprite).spriteFrame=i});var s=this.getTilePos(cc.p(i.x-this.maxMoveSpeed,i.y));if(this.tryMoveToTarTile(s)){var o=this.getTilePos(cc.p(i.x-this.maxMoveSpeed,i.y+this.tileSize.height-2));if(this.tryMoveToTarTile(o))this.player.xSpeed=-this.maxMoveSpeed;else{var a=this.getTilePos(this.player.getPosition()),h=this.getTilePixelPos(a);this.player.setPosition(i.x-1*this.maxMoveSpeed,h.y+1)}}else{var c=this.getTilePos(cc.p(i.x-this.maxMoveSpeed,i.y+.5*this.tileSize.height));if(this.tryMoveToTarTile(c)){var r=this.getTilePixelPos(c);this.player.setPosition(i.x-1*this.maxMoveSpeed,r.y+1)}else{var n=this.getTilePixelPos(cc.p(s.x+1,s.y));this.player.setPosition(n.x+1,i.y),this.player.xSpeed=0}}}if(this.player.accRight){var l=this;cc.loader.loadRes("Player/right",cc.SpriteFrame,function(e,i){e?console.log(e):l.player.getComponent(cc.Sprite).spriteFrame=i});var p=this.getTilePos(cc.p(i.x+this.player.width+this.maxMoveSpeed,i.y));if(this.tryMoveToTarTile(p)){var y=this.getTilePos(cc.p(i.x+this.player.width+this.maxMoveSpeed,i.y+this.tileSize.height-2));if(this.tryMoveToTarTile(y))this.player.xSpeed=this.maxMoveSpeed;else{var d=this.getTilePos(this.player.getPosition()),m=this.getTilePixelPos(d);this.player.setPosition(i.x+1*this.maxMoveSpeed,m.y+1)}}else{var T=this.getTilePos(cc.p(i.x+this.player.width+this.maxMoveSpeed,i.y+.5*this.tileSize.height));if(this.tryMoveToTarTile(T)){var g=this.getTilePixelPos(T);this.player.setPosition(i.x+1*this.maxMoveSpeed,g.y+1)}else{var x=this.getTilePixelPos(cc.p(p.x-1,p.y));this.player.setPosition(x.x+1,i.y),this.player.xSpeed=0}}}if(this.player.accLeft||this.player.accRight||(this.player.xSpeed=0),this.player.x+=this.player.xSpeed,this.player.accUp){var u=this;cc.loader.loadRes("Player/back",cc.SpriteFrame,function(e,i){e?console.log(e):u.player.getComponent(cc.Sprite).spriteFrame=i});var f=this.getTilePos(cc.p(i.x,i.y+this.tileSize.height+this.maxMoveSpeed));if(this.tryMoveToTarTile(f)){var v=this.getTilePos(cc.p(i.x+this.player.width,i.y+this.tileSize.height+this.maxMoveSpeed));if(this.tryMoveToTarTile(v))this.player.ySpeed=this.maxMoveSpeed;else{var S=this.getTilePos(this.player.getPosition()),P=this.getTilePixelPos(S);this.player.setPosition(P.x+1,i.y+1*this.maxMoveSpeed)}}else{var b=this.getTilePos(cc.p(i.x+.5*this.player.width,i.y+this.tileSize.height+this.maxMoveSpeed));if(this.tryMoveToTarTile(b)){var _=this.getTilePixelPos(b);this.player.setPosition(_.x+1,i.y+1*this.maxMoveSpeed)}else{var M=this.getTilePixelPos(cc.p(f.x,f.y+1));this.player.setPosition(i.x,M.y+1),this.player.ySpeed=0}}}if(this.player.accDown){var L=this;cc.loader.loadRes("Player/front",cc.SpriteFrame,function(e,i){e?console.log(e):L.player.getComponent(cc.Sprite).spriteFrame=i});var z=this.getTilePos(cc.p(i.x,i.y-this.maxMoveSpeed));if(this.tryMoveToTarTile(z)){var C=this.getTilePos(cc.p(i.x+this.player.width,i.y-this.maxMoveSpeed));if(this.tryMoveToTarTile(C))this.player.ySpeed=-this.maxMoveSpeed;else{var F=this.getTilePos(this.player.getPosition()),R=this.getTilePixelPos(F);this.player.setPosition(R.x+1,i.y-1*this.maxMoveSpeed)}}else{var w=this.getTilePos(cc.p(i.x+this.player.width,i.y-this.maxMoveSpeed));if(this.tryMoveToTarTile(w)){var D=this.getTilePixelPos(w);this.player.setPosition(D.x+1,i.y-1*this.maxMoveSpeed)}else{var E=this.getTilePixelPos(cc.p(z.x,z.y-1));this.player.setPosition(i.x,E.y+1),this.player.ySpeed=0}}}this.player.accUp||this.player.accDown||(this.player.ySpeed=0),this.player.y+=this.player.ySpeed,this.updatePlayerTilePos()}},tryMoveToTarTile:function(e){if(this.mainLayer.getTileGIDAt(e))return!1;if(null!=this.bombTiles&&0!==this.bombTiles.length)for(var i in this.bombTiles)if(e.equals(this.bombTiles[i]))return!!e.equals(this.playerTile);return!0},getTileType:function(e,i){var t=this.map.getPropertiesForGID(e.getTileGIDAt(i));return t?t.type:i.equals(this.playerTile)?"player":null},getTilePos:function(e){var i=Math.floor(e.x/this.tileSize.width),t=Math.floor((this.mapSize.height-e.y)/this.tileSize.height);return cc.p(i,t)},getTilePixelPos:function(e){var i=e.x*this.tileSize.width,t=this.mapSize.height-(e.y+1)*this.tileSize.height;return cc.p(i,t)},updatePlayerTilePos:function(){var e=this.getTilePos(this.player.getPosition()),i=this.getTilePixelPos(e);this.player.getPosition().x-i.x>this.player.width/2&&(e=cc.p(e.x+1,e.y)),this.playerTile=e}}),cc._RF.pop()},{}],joyStick:[function(e,i,t){"use strict";cc._RF.push(i,"f63f3eNyfJD+4fM91ijTQbh","joyStick");var s=e("JoystickDefines");cc.Class({extends:cc.Component,properties:{_bomberGame:{default:null,displayName:"游戏场景节点"},stickDot:{default:null,type:cc.Node,displayName:"摇杆节点"},_angle:{default:null,displayName:"当前触摸的角度"},_radian:{default:null,displayName:"弧度"},stickType:{default:s.DirectionType.FOUR,type:s.DirectionType,displayName:"摇杆方向"}},onLoad:function(){this._bomberGame=this.node.parent.getComponent("game"),console.log(this._bomberGame),this.initJoyStickTouchEvent()},start:function(){},initJoyStickTouchEvent:function(){var e=this;e.node.on(cc.Node.EventType.TOUCH_START,this._touchStartEvent,e),e.node.on(cc.Node.EventType.TOUCH_MOVE,this._touchMoveEvent,e),e.node.on(cc.Node.EventType.TOUCH_END,this._touchEndEvent,e),e.node.on(cc.Node.EventType.TOUCH_CANCEL,this._touchEndEvent,e)},_getDistance:function(e,i){return Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))},_getRadian:function(e){return this._radian=Math.PI/180*this._getAngle(e),this._radian},_getAngle:function(e){var i=cc.p(0,0);return this._angle=Math.atan2(e.y-i.y,e.x-i.x)*(180/Math.PI),this._angle},_setSpeed:function(e){this._getDistance(e,this.node.getPosition())<this._radius?this._speed=this._speed1:this._speed=this._speed2},_touchStartEvent:function(e){var i=this.node.convertToNodeSpaceAR(e.getLocation()),t=this._getDistance(i,cc.p(0,0)),s=this.node.width/2;this._stickPos=i;var o=i.x,a=i.y;return s>t&&(this.stickDot.setPosition(cc.p(o,a)),!0)},_touchMoveEvent:function(e){var i=this.node.convertToNodeSpaceAR(e.getLocation()),t=this._getDistance(i,cc.p(0,0)),s=this.node.width/2;if(s>t)console.log(cc.p(i.x,i.y)),this.stickDot.setPosition(cc.p(i.x,i.y)),this._getAngle(cc.p(i.x,i.y));else{var o=i.x,a=i.y,h=Math.cos(this._getRadian(cc.p(o,a)))*s,c=Math.sin(this._getRadian(cc.p(o,a)))*s;this.stickDot.setPosition(cc.p(h,c)),this._getAngle(cc.p(o,a))}this._fourDirectionsMove()},_touchEndEvent:function(){this.stickDot.setPosition(cc.p(0,0)),this._speed=0,this._angle=null,this._fourDirectionsMove()},_fourDirectionsMove:function(){this._bomberGame.player.accLeft=!1,this._bomberGame.player.accRight=!1,this._bomberGame.player.accUp=!1,this._bomberGame.player.accDown=!1,null!=this._angle&&(this._angle<45&&this._angle>-45&&(this._bomberGame.player.accRight=!0),this._angle>45&&this._angle<135&&(this._bomberGame.player.accUp=!0),(this._angle>135&&this._angle<180||this._angle>-180&&this._angle<-135)&&(this._bomberGame.player.accLeft=!0),this._angle>-135&&this._angle<-45&&(this._bomberGame.player.accDown=!0))}}),cc._RF.pop()},{JoystickDefines:"JoystickDefines"}]},{},["JoystickDefines","bomb","enemy","fireHorAnim","fireVerAnim","game","joyStick"]);
//# sourceMappingURL=project.js.map